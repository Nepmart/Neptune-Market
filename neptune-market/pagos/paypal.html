<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pago con PayPal - Neptune Market</title>
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <main class="paypal-main">
    <h2>ðŸ’³ Pago con PayPal</h2>
    <div id="paypal-button-container"></div>
  </main>

<script>
    const cartTotal = parseFloat(localStorage.getItem("cartTotal")) || 0;
    
    if (!cartTotal || cartTotal === 0) {
        alert("Error: No se encontrÃ³ informaciÃ³n de pago. Volviendo a la tienda.");
        window.location.href = "../index.html";
    }

    // Convertir el total a USD
    const exchangeRateDOPtoUSD = 59.5;
    const totalInUSD = (cartTotal / exchangeRateDOPtoUSD).toFixed(2);
    
    paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: totalInUSD,
              currency_code: 'USD'
            },
            description: "Compra en Neptune Market"
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert("Â¡Gracias por tu compra, " + details.payer.name.given_name + "!");
          localStorage.removeItem("cart");
          localStorage.removeItem("cartTotal");
          window.location.href = "../index.html";
        });
      },
      onError: function(err) {
        alert("OcurriÃ³ un error con el pago. Por favor, intÃ©ntalo de nuevo.");
        console.error("Error de PayPal:", err);
      }
    }).render('#paypal-button-container');
</script>
</body>
</html>