<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pago con PayPal - Neptune Market</title>

  <!-- âœ… SDK de PayPal con tu Client ID real -->
  <script src="https://www.paypal.com/sdk/js?client-id=AeR_uA33JLhmp8X7TlvJtD9Bogz8faxPwdnn0NLT98IZTdsEmeuIxu6hePK2z4AUwhlMNjeQAcXJBBPn&currency=USD"></script>

  <!-- âœ… Asegura que el CSS apunte bien segÃºn tu estructura -->
  <link rel="stylesheet" href="../style.css" />
</head>

<body>
  <main class="paypal-main">
    <h2>ðŸ’³ Pago con PayPal</h2>
    <p>Por favor, confirma tu pago para completar tu pedido.</p>
    <div id="paypal-button-container"></div>
  </main>

  <script>
    // âœ… Cargar el total del carrito almacenado en localStorage
    const cartTotal = parseFloat(localStorage.getItem("cartTotal")) || 0;

    if (!cartTotal || cartTotal <= 0) {
      alert("No se encontrÃ³ informaciÃ³n del pedido. Volviendo a la tienda...");
      window.location.href = "index.html";
    }

    // ðŸ’µ ConversiÃ³n de RD$ a USD
    const exchangeRateDOPtoUSD = 59.5;
    const totalInUSD = (cartTotal / exchangeRateDOPtoUSD).toFixed(2);

    // ðŸŸ¢ ConfiguraciÃ³n del botÃ³n de PayPal
    paypal.Buttons({
      style: {
        layout: 'vertical',
        color: 'gold',
        shape: 'rect',
        label: 'paypal'
      },

      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              value: totalInUSD,
              currency_code: 'USD'
            },
            description: "Compra en Neptune Market"
          }]
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert("âœ… Â¡Gracias por tu compra, " + details.payer.name.given_name + "!");
          localStorage.removeItem("cart");
          localStorage.removeItem("cartTotal");
          window.location.href = "index.html";
        });
      },

      onError: function(err) {
        console.error("Error de PayPal:", err);
        alert("OcurriÃ³ un error al procesar el pago. Intenta nuevamente.");
      }
    }).render('#paypal-button-container');
  </script>
</body>
</html>